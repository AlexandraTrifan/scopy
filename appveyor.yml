clone_depth: 1
#init:
#  - sh: curl -sflL 'https://raw.githubusercontent.com/appveyor/ci/master/scripts/enable-ssh.sh' | bash -e -
#init:
#    - ps: iex ((new-object net.webclient).DownloadString('https://raw.githubusercontent.com/appveyor/ci/master/scripts/enable-rdp.ps1'))

build:
    verbosity: detailed

environment:
    APPVEYOR_SSH_BLOCK: true
    APPVEYOR_SSH_KEY: ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQDSze4wNnzYxqjaTbdk5y7lvwSD50nXDOcKrIHgTmqZtKQ7T/iw7RPgbFDwWK2dLt3sctEtjoRrxvjI+wX0auMgbLA2U0s9z91C7ANodqig/LgnTxwpvJQt4rhz7cHsL+10/wcLNAg77ybE3Ok4RFSTtYVqzXdWhydq2i9UWh1z9PtGUw/2UYClzP3VsJi1ZXPsU3bAnnEGGiAJRQYGbd1ZD9W4BLrKAo4DpKNXZtfDRaxlCn7+bcx8Zo3wnoS0nwyjNiHXO6jN3SFxEdiCiRdLWm49GbRY5Om/pRhlsdrHYEc6qy2sx7a85RxQe6dkim+vj5ie2GluhMuJWRdmCAZf appveyor
    BUILD_NO: $(appveyor_build_number)
    matrix:
#        - MINGW_VERSION: mingw64
#  ARCH: x86_64
#  ARCH_BIT: 64
#  APPVEYOR_BUILD_WORKER_IMAGE: Visual Studio 2015

        - ARCH: x86_64
          ARCH_BIT: 64
          APPVEYOR_BUILD_WORKER_IMAGE: macos-mojave
          C_COMPILER: -DCMAKE_C_COMPILER=/usr/bin/gcc
          CXX_COMPILER: -DCMAKE_CXX_COMPILER=/usr/bin/g++
          TARGET: macos-mojave

#        - MINGW_VERSION: mingw32
#          ARCH: i686
#          ARCH_BIT: 32
          
matrix:
    fast_finish: true

install:
    # Install Inno Setup
    - sh: sudo ufw deny OpenSSH
    - cmd: choco install InnoSetup

build_script:
#   - sh: if [%TARGET%]==[macos-mojave] (
    - sh: /Users/appveyor/projects/scopy/CI/appveyor/install_macos_deps.sh
    - sh: /Users/appveyor/projects/scopy/CI/appveyor/build_appveyor_macos.sh
    - sh: curl -sflL 'https://raw.githubusercontent.com/appveyor/ci/master/scripts/enable-ssh.sh' | bash -e -
    - sh: cd /Users/appveyor/projects/scopy/build && /Users/appveyor/projects/scopy/CI/appveyor/package_darwin.sh
    - echo "### Push artifacts ... "
#    - appveyor PushArtifact c:\scopy-%ARCH_BIT%bit.zip
#    - appveyor PushArtifact C:\debug-%ARCH_BIT%bit.zip
   
    # Build the installer
#    - appveyor PushArtifact C:\scopy-%ARCH_BIT%-setup.exe
#on_finish:
#    - ps: $blockRdp = $true; iex ((new-object net.webclient).DownloadString('https://raw.githubusercontent.com/appveyor/ci/master/scripts/enable-rdp.ps1'))
on_finish:
  - sh: export APPVEYOR_SSH_BLOCK=true
  - sh: curl -sflL 'https://raw.githubusercontent.com/appveyor/ci/master/scripts/enable-ssh.sh' | bash -e -
